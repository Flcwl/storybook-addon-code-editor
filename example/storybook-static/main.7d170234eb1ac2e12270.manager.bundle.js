(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{461:function(module,exports,__webpack_require__){__webpack_require__(462),__webpack_require__(830),__webpack_require__(826),__webpack_require__(835),__webpack_require__(831),__webpack_require__(828),__webpack_require__(829),__webpack_require__(827),__webpack_require__(832),module.exports=__webpack_require__(833)},522:function(module,exports){},826:function(module,exports,__webpack_require__){(0,__webpack_require__(834).register)()},834:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"register",(function(){return register}));var react=__webpack_require__(0),react_default=__webpack_require__.n(react),index_3ae04fda=__webpack_require__(2),esm=__webpack_require__(455),types=__webpack_require__(139);const eventCodeChange="liveCodeEditor:codeChange";const createEditorP=function loadMonacoEditor(){return function injectScript(url){return new Promise(((resolve,reject)=>{const script=document.createElement("script");script.src=url,script.defer=!0,script.onload=resolve,script.onerror=reject,document.head.append(script)}))}("https://unpkg.com/monaco-editor@0.33.0/min/vs/loader.js").then((()=>new Promise((resolve=>{window.require.config({paths:{vs:"https://unpkg.com/monaco-editor@0.33.0/min/vs"}}),window.require(["vs/editor/editor.main"],resolve)}))))}().then((monaco=>{monaco.languages.typescript.typescriptDefaults.setCompilerOptions({jsx:2}),monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSemanticValidation:!0,noSyntaxValidation:!1});let fileCount=1;return(initialCode,container)=>{const uri=monaco.Uri.parse(`file:///index${fileCount++}.tsx`);return monaco.editor.create(container,{model:monaco.editor.createModel(initialCode,"typescript",uri),tabSize:2,automaticLayout:!0})}}));function Editor({onInput:onInput,value:value}){const editorContainerRef=Object(react.useRef)(null),editorRef=Object(react.useRef)(),onInputRef=Object(react.useRef)(onInput);return onInputRef.current!==onInput&&(onInputRef.current=onInput),Object(react.useEffect)((()=>{let didCleanup=!1,cleanup=()=>{didCleanup=!0};const setupEditor=editor=>{editor.setValue(value);const subscription=editor.onDidChangeModelContent((()=>{onInputRef.current(editor.getValue())}));cleanup=()=>{subscription.dispose()}};return editorRef.current?setupEditor(editorRef.current):createEditorP.then((createEditor=>{didCleanup||(editorRef.current||(editorRef.current=createEditor(value,editorContainerRef.current)),setupEditor(editorRef.current))})),()=>cleanup()}),[value]),react_default.a.createElement("div",{ref:editorContainerRef,style:{height:"100%"}})}function register(){esm.a.register("liveCodeEditor",(api=>{const channel=api.getChannel(),{setCurrentStory:setCurrentStory,setCurrentStoryCode:setCurrentStoryCode,getCurrentStoryCode:getCurrentStoryCode}=function createStore(channel){let currentStoryId="";const currentCodes=new Map;return channel.on(eventCodeChange,(([id,currentCode])=>{currentCodes.set(id,currentCode)})),channel.on("liveCodeEditor:storyChange",(([id,initialCode])=>{currentCodes.has(id)||currentCodes.set(id,initialCode),currentStoryId!==id&&(currentStoryId=id,channel.emit(eventCodeChange,[id,currentCodes.get(id)]))})),{setCurrentStory:(id,initialCode)=>channel.emit("liveCodeEditor:storyChange",[id,initialCode]),setCurrentStoryCode:code=>channel.emit(eventCodeChange,[currentStoryId,code]),getCurrentStoryCode:()=>{var _a;return null!==(_a=currentCodes.get(currentStoryId))&&void 0!==_a?_a:""},onCodeChange:callback=>{const handler=([,currentCode])=>{callback(currentCode)};return channel.on(eventCodeChange,handler),()=>{channel.off(eventCodeChange,handler)}}}}(channel);esm.a.add("liveCodeEditor",{title:"Live code editor",type:types.a.PANEL,paramKey:"liveCodeEditor",render({active:active,key:key}){var _a,_b,_c;const storyData=api.getCurrentStoryData();return storyData&&setCurrentStory(storyData.id,null!==(_c=null===(_b=null===(_a=storyData.parameters)||void 0===_a?void 0:_a.liveCodeEditor)||void 0===_b?void 0:_b.initialCode)&&void 0!==_c?_c:""),active&&storyData?react_default.a.createElement(index_3ae04fda.z,{active:!!active,key:key},react_default.a.createElement(Editor,{onInput:setCurrentStoryCode,value:getCurrentStoryCode()})):null}})}))}}},[[461,3,4]]]);